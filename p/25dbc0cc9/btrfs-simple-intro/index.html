<!doctype html><html lang=zh-cn><head><meta name=color-scheme content="dark"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.139.4"><meta name=description content="BTRFS 是 Linux 所支持的一个先进且主流的文件系统。
它的基础使用方法与 EXT4、XFS 等老前辈是相同的；但若你止步于此，就会错过 BTRFS 的高级功能。本文用具体实践带你来快速入门 BTRFS，以便后续进阶。
"><meta property="og:title" content="BTRFS 实践式快速入门"><meta property="og:description" content="BTRFS 是 Linux 所支持的一个先进且主流的文件系统。
它的基础使用方法与 EXT4、XFS 等老前辈是相同的；但若你止步于此，就会错过 BTRFS 的高级功能。本文用具体实践带你来快速入门 BTRFS，以便后续进阶。
"><meta property="og:image:url" content="https://blog.celestialy.top/p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash_hu11139010463601271781.webp"><meta property="og:image:width" content="1200"><meta property="og:image.height" content="675"><meta property="og:image:type" content="image/webp"><meta property="og:url" content="https://blog.celestialy.top/p/25dbc0cc9/btrfs-simple-intro/"><meta property="og:site_name" content="clsty 的网络空间站"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-06-07T23:08:00+08:00"><meta property="article:modified_time" content="2024-06-07T23:08:00+08:00"><meta property="article:tag" content="linux"><meta property="article:tag" content="btrfs"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.celestialy.top/p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash_hu11139010463601271781.webp"><meta name=twitter:title content="BTRFS 实践式快速入门"><meta name=twitter:description content="BTRFS 是 Linux 所支持的一个先进且主流的文件系统。
它的基础使用方法与 EXT4、XFS 等老前辈是相同的；但若你止步于此，就会错过 BTRFS 的高级功能。本文用具体实践带你来快速入门 BTRFS，以便后续进阶。
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"NewsArticle","dateModified":"2024-06-07T23:08:00+08:00","datePublished":"2024-06-07T23:08:00+08:00","headline":"BTRFS 实践式快速入门","image":["https://blog.celestialy.top/p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash_hu11139010463601271781.webp"]}</script><title>BTRFS 实践式快速入门 | clsty 的网络空间站
</title><link rel=preload href=/IBM-Plex-Sans/fonts/split/woff2/IBMPlexSans-Bold-Latin1.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/IBM-Plex-Sans/fonts/split/woff2/IBMPlexSans-Regular-Latin1.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/IBM-Plex-Sans-Condensed/fonts/split/woff2/IBMPlexSansCondensed-Light-Latin1.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/IBM-Plex-Sans-Condensed/fonts/split/woff2/IBMPlexSansCondensed-Text-Latin1.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/IBM-Plex-Sans-Condensed/fonts/split/woff2/IBMPlexSansCondensed-SemiBold-Latin1.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/fontfaces.min.5442583bc9892da790ae4dfc5e0be3a914b9a11806fc02b0c0ed61f0456e76a1.css integrity="sha256-VEJYO8mJLaeQrk38XgvjqRS5oRgG/AKwwO1h8EVudqE=" media=screen><link rel=stylesheet href=/css/screen.min.b2bfc25fa5b5fb7d7ff2571c70968e348a33f0811b9739e6c79eaba594c86eb2.css integrity="sha256-sr/CX6W1+31/8lcccJaONIoz8IEblznmx56rpZTIbrI=" media=screen><link rel=stylesheet href=/css/custom.min.aee6477538ab4ab378a04100067edf126d56e3a31c3c58987fd57d65953d1cc9.css integrity="sha256-ruZHdTirSrN4oEEABn7fEm1W46McPFiYf9V9ZZU9HMk=" media=screen><script src=/js/ls.min.6caaaee2899d2d0bb2cd66e696389981f80744632f18ac48f14a6b0f559c46bd.js integrity="sha256-bKqu4omdLQuyzWbmljiZgfgHRGMvGKxI8UprD1WcRr0=" async></script><link rel=icon type=image/svg+xml href=/favicon/favicon.svg><link rel=icon type=image/png href=/favicon/favicon.png><link rel=stylesheet href=/css/pagestyle/post.css integrity media=screen></head><body><script>let FF_FOUC_FIX</script><header class="l-masthead l-nav" id=l-masthead><div class="ctrl ctrl-left" id=l-logo><a class="ctrl__title ctrl__title--text nav__title" href=https://blog.celestialy.top/><span>clsty 的网络空间站</span></a></div><div class="ctrl ctrl-left" id=l-menu><nav><ul class=ul--row><li><a class="ctrl__menulink nav-main__link" href=/>❀新鲜事❀</a></li><li><a class="ctrl__menulink nav-main__link has-active" href=/blog/>❈散文屋❈</a></li><li><a class="ctrl__menulink nav-main__link" href=/doc/>❉文档馆❉</a></li><li><a class="ctrl__menulink nav-main__link" href=/authors/>・人・</a></li><li><a class="ctrl__menulink nav-main__link" href=/categories/>〈  类别</a></li><li><a class="ctrl__menulink nav-main__link" href=/series/>|  系列  |</a></li><li><a class="ctrl__menulink nav-main__link" href=/tags/>标签  〉</a></li></ul></nav></div><div class="ctrl ctrl-right" id=l-ctrl><nav><ul class=ul--row></ul></nav><a href=/search/ id=search class=ctrl__button title="Open search"><span class='icon icon--material icon--normal'><svg viewBox="0 0 24 24"><path d="m19.55 20.575-6.3-6.275q-.75.625-1.725.975t-2 .35q-2.575.0-4.35-1.775Q3.4 12.075 3.4 9.5q0-2.55 1.775-4.338 1.775-1.787 4.35-1.787 2.55.0 4.325 1.775 1.775 1.775 1.775 4.35.0 1.075-.35 2.05-.35.975-.95 1.7l6.275 6.275zm-10.025-6.45q1.925.0 3.263-1.35 1.337-1.35 1.337-3.275.0-1.925-1.337-3.275-1.338-1.35-3.263-1.35-1.95.0-3.287 1.35Q4.9 7.575 4.9 9.5t1.338 3.275q1.337 1.35 3.287 1.35z"/></svg></span>
</a><button id=toggle-toc class=ctrl__button aria-label="Toggle TOC" title=开/关导航目录><span class="icon icon--material"></span></button><aside class=is-closed id=toc><div class=toc__box><div class=toc__content><nav class=toc__list><h2 class=toc__title><a href=#l-content-box class=nav__link>在此页面上</a></h2><ul><li class="nav__item nav__item--2"><a href=/p/25dbc0cc9/btrfs-simple-intro/#%e5%bc%95%e5%ad%90>引子</a></li><li class="nav__item nav__item--2"><a href=/p/25dbc0cc9/btrfs-simple-intro/#%e6%a0%bc%e5%bc%8f%e5%8c%96%e4%b8%8e%e6%8c%82%e8%bd%bd>格式化与挂载</a></li><li class="nav__item nav__item--2"><a href=/p/25dbc0cc9/btrfs-simple-intro/#%e5%ad%90%e5%8d%b7%e6%98%af%e7%9b%ae%e5%bd%95>子卷，是目录？</a></li><li class="nav__item nav__item--2"><a href=/p/25dbc0cc9/btrfs-simple-intro/#%e5%ad%90%e5%8d%b7%e8%83%bd%e8%a2%ab%e5%88%97%e5%87%ba>子卷，能被列出</a></li><li class="nav__item nav__item--2"><a href=/p/25dbc0cc9/btrfs-simple-intro/#%e5%ad%90%e5%8d%b7%e8%83%bd%e6%8c%87%e5%ae%9a%e5%8f%82%e6%95%b0%e6%8c%82%e8%bd%bd>子卷，能指定参数挂载</a></li><li class="nav__item nav__item--2"><a href=/p/25dbc0cc9/btrfs-simple-intro/#%e5%ad%90%e5%8d%b7%e8%83%bd%e8%a2%ab%e5%bf%ab%e7%85%a7>子卷，能被快照</a></li><li class="nav__item nav__item--2"><a href=/p/25dbc0cc9/btrfs-simple-intro/#%e5%ad%90%e5%8d%b7%e5%8f%af%e4%bb%a5%e5%9b%9e%e6%bb%9a%e5%88%b0%e5%bf%ab%e7%85%a7>子卷，可以“回滚”到快照</a></li><li class="nav__item nav__item--2"><a href=/p/25dbc0cc9/btrfs-simple-intro/#%e5%ad%90%e5%8d%b7%e5%8f%af%e4%bb%a5%e8%b7%a8%e8%ae%be%e5%a4%87%e4%bc%a0%e8%be%93>子卷，可以跨设备传输</a></li><li class="nav__item nav__item--2"><a href=/p/25dbc0cc9/btrfs-simple-intro/#btrfs-%e8%b5%84%e6%96%99%e6%8c%87%e8%b7%af>BTRFS 资料指路</a></li></ul></nav></div></div></aside></div></header><div class=l-page><main id=l-main class=l-tnp><div id=l-content-box class="l-box l-box--full"><article id=l-content data-pagefind-body><header class=page-header><div class="meta meta--head meta--left" data-pagefind-ignore><ul class=meta__list><li class="taxo-shape taxo-shape--category"><ul class=ul--row><li class=meta__hanging><a class="link link--nav" href=/categories/ title="All Categories"><span class='icon icon--material icon--tiny'><svg viewBox="0 0 20 20"><path d="m5.042 9.479 4.979-8.146L15 9.479zm9.666 9.167q-1.646.0-2.791-1.156-1.146-1.157-1.146-2.782.0-1.646 1.146-2.791 1.145-1.146 2.791-1.146 1.625.0 2.782 1.146 1.156 1.145 1.156 2.791.0 1.625-1.156 2.782-1.157 1.156-2.782 1.156zm-12.583-.417v-7.062h7.063v7.062z"/></svg></span></a></li><li class="meta__item meta__item--taxo"><a class="meta__text link link--nav" href=/categories/knowledge/>知识向</a></li></ul></li><li class="taxo-shape taxo-shape--tag"><ul class=ul--row><li class=meta__hanging><a class="link link--nav" href=/tags/ title="All Tags"><span class='icon icon--material icon--tiny'><svg viewBox="0 0 20 20"><path d="M3.188 10.542v5.875L.917 15.5zm4.062 7.75h-2.5V11.5zm1.958.75L4.146 5.333 14 1.75l5.042 13.729zm.021-10.5q.396.0.677-.282.282-.281.282-.677.0-.375-.282-.656-.281-.281-.677-.281-.375.0-.656.281t-.281.656q0 .396.281.677.281.282.656.282z"/></svg></span></a></li><li class="meta__item meta__item--taxo"><a class="meta__text link link--nav" href=/tags/linux/>Linux
</a>&zwj;<span class=meta__separator>•</span></li><li class="meta__item meta__item--taxo"><a class="meta__text link link--nav" href=/tags/btrfs/>Btrfs</a></li></ul></li></ul><div class=published><ul class=author-list><li><a href=/authors/clsty/ title=clsty><figure class="fig fig--w-pt2 fig--portrait-small"><span class=img__frame style=display:flex;justify-content:center;align-items:center><span class=img__c style=position:relative;width:100%;height:0;padding-bottom:100%><img alt=clsty class=img--ls height=72 loading=lazy src="data:image/webp;base64,UklGRkgCAABXRUJQVlA4IDwCAAAwDgCdASpIAEgAPsFUn0mjoiEVKQVoOwwE8YBp/L/eZ9CO2d8QD1h/QBvM28235LN4Vk8svSjs6Fb6zbtoFupI+dyFeHplFKUSKUQDVvDi8N4Vg76O3JleX3A4xIhix9JIEU8iT97aQ5E1I4HgSgdDnp60J1vOSOnkgAD+uQGW+hjWGjqOFsHcZH5SA82lA83PBwgmufC2F6vBy4l89pPa5Tk/ge0qz0CAF7cdNrwSj3KredZ3cqj5yuIT5Jzs1ltOE/JGg1TcTyCC2gVB6hOJMUXt1oDgg4WFIMiW8bNy8c4X9yCvqFYxpi5p4Age+NgYWtvJ+jGBNND+2ubtCcC6Zn7O7WkPHFy5txHndLP8WmCBj7EoKu700UkRerNoHdKaJVozRqdAvKZJkS8R7U3j6LehJ0vL1OMUHZgjr9gpqgl1VLMatnsGTsRL0ZlBYjsFaxSL6/hqvDK9Nkgv+VenWkY/So/b3m+FK6/VVuxdWNmj8sdYkPJaNRuqtZ/Cz97ZjA/35KiLFcucippxCbFujE54ortYig4opBeQzn/RpHBi8mplK6ByyTcg1wgm/y//cYXt6X5kSGLXI/PQMd5KTLwNIkRsEFR6gKnjrTUL8xWMeBifouQe3I2PfJ/oTipzEMwKhPlfHRst/85ewVJNqDCkSbuMg4MEGDCuUXMFMuB+Qle7KBrvokrxctCBwMgoGZN5CitFJ69TVKWX6GsxIdsQqn1l8WFEW7SlnfghraN1tEJauXUAA1iAAA==" width=72></span></span></figure></a></li></ul><ul class="meta__list meta__list--date"><li class=meta__item><span class=meta__icon><span class='icon icon--material icon--tiny'><svg viewBox="0 0 20 20"><path d="M12.021 14.938q-.896.0-1.521-.615t-.625-1.49q0-.895.625-1.521.625-.624 1.521-.624.875.0 1.489.624.615.626.615 1.521.0.875-.615 1.49-.614.615-1.489.615zM2.333 18.5V3.25h2.584V1.5h1.875v1.75h6.416V1.5h1.875v1.75h2.584V18.5zm1.979-1.979h11.376V8.375H4.312z"/></svg></span>
</span><time class=meta__text datetime=2024-06-07T23:08:00+08:00>Jun 7, 2024</time></li><li class="meta__item meta__date"><span class='icon icon--material icon--tiny'><svg viewBox="0 0 20 20"><path d="M10 18.5q-1.771.0-3.323-.667-1.552-.666-2.698-1.812t-1.812-2.698Q1.5 11.771 1.5 10t.667-3.323q.666-1.552 1.812-2.698t2.698-1.812Q8.229 1.5 10 1.5t3.323.667q1.552.666 2.698 1.812t1.812 2.698Q18.5 8.229 18.5 10t-.667 3.323q-.666 1.552-1.812 2.698t-2.698 1.812Q11.771 18.5 10 18.5zm2.583-4.562 1.375-1.355-3-2.979V5.896H9.042v4.458z"/></svg></span>
<span class=meta__text>11:08 pm</span></li></ul></div></div><div class="title title--sans margin-full"><h1 data-pagefind-weight=10>BTRFS 实践式快速入门</h1></div><aside class=featured-image><figure class="fig fig--ph-right fig--w-small fig--featured"><span class="img__frame img__frame--box-shadow" style="display:flex;justify-content:center;align-items:center;background-image:linear-gradient(to right,#342d1c,#a79b62)"><span class=img__c style=position:relative;width:100%;height:0;padding-bottom:66.4179%><img alt="Featured image" class="img--ls img--ph lazyload" data-optimumx=auto data-sizes=auto data-srcset="/p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash-256x.webp 256w, /p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash-286x.webp 286w, /p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash-319x.webp 319w, /p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash-330x.webp 330w, /p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash-356x.webp 356w, /p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash-397x.webp 397w, /p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash-444x.webp 444w, /p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash-495x.webp 495w, /p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash-553x.webp 553w, /p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash-617x.webp 617w, /p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash-689x.webp 689w, /p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash-769x.webp 769w, /p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash-858x.webp 858w" height=219 src=/p/25dbc0cc9/btrfs-simple-intro/pic.featured/mr-cup-fabien-barral-o6GEPQXnqMY-unsplash-330x.webp srcset=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 width=330></span></span><figcaption class=caption><span class=caption__attr data-pagefind-ignore>(<a class="link link--text" href=https://unsplash.com/photos/o6GEPQXnqMY>Mr Cup Fabien Barral/Unsplash</a>)</span></figcaption></figure></aside></header><div class="md md--sans md--h-sans md--margin-full"><style>.wordcount-label{font-size:16px;text-align:right}</style><span class=wordcount-label>字词数：5341&nbsp;&nbsp;&nbsp;✧&nbsp;&nbsp;&nbsp;</span><style>.pageviews-label{font-size:16px;text-align:right}</style><span class=pageviews-label>阅读量：<span class=pageviews-label id=ArtalkPV></span>&nbsp;&nbsp;&nbsp;✧&nbsp;&nbsp;</span>
<time id=LastmodTime datetime=2024-6-7></time>
<span id=expiredTip class=expiredTip-label></span><style>.expiredTip-label{font-size:16px}</style><script>function GetNumberOfDays(e,t){var n=Date.parse(new Date(e)),s=Date.parse(new Date(t)),o=parseInt((s-n)/(1e3*60*60*24));return o}var date=new Date,ny=date.getFullYear(),nm=date.getMonth()+1,nd=date.getDate(),a1=document.getElementById("LastmodTime").dateTime,a2=ny+"-"+nm+"-"+nd,num=GetNumberOfDays(a1,a2),str1="最近更新：距今",str2="日";document.getElementById("expiredTip").innerHTML=str1+"&nbsp;"+num+"&nbsp;"+str2</script><div id=permaportalValue style=display:none>25dbc0cc9</div><p class=box style=white-space:nowrap;font-size:1.2em;overflow-x:auto;clear:none>以下按钮可供你方便地引用本文。URL 中即使域名变化，其后的路径也将始终指向原本的内容。
<script>function copyToClipboard(e,t){var n,s,o=document.getElementById(e).innerText;navigator.clipboard.writeText(o),n=document.getElementById(t),s=n.textContent,n.textContent="✓ 已复制",setTimeout(function(){n.textContent=s},1200)}</script><br><button id=permaportal-button onclick='copyToClipboard("permaportallink","permaportal-button")' class=permaportal--button>单击复制</button>
<span id=permaportallink class=permaportal--linkbox>https://blog.celestialy.top/p/25dbc0cc9</span><br><button id=permaportal-button-md onclick='copyToClipboard("permaportallink-md","permaportal-button-md")' class=permaportal--button>markdown</button>
<span id=permaportallink-md class=permaportal--linkbox>[BTRFS 实践式快速入门 | clsty 的网络空间站](https://blog.celestialy.top/p/25dbc0cc9)</span><br><button id=permaportal-button-org onclick='copyToClipboard("permaportallink-org","permaportal-button-org")' class=permaportal--button>org-mode</button>
<span id=permaportallink-org class=permaportal--linkbox>[[https://blog.celestialy.top/p/25dbc0cc9][BTRFS 实践式快速入门 | clsty 的网络空间站]]</span></p><p class=p-first>BTRFS 是 Linux 所支持的一个先进且主流的文件系统。</p><p>它的基础使用方法与 EXT4、XFS 等老前辈是相同的；但若你止步于此，就会错过 BTRFS 的高级功能。本文用具体实践带你来快速入门 BTRFS，以便后续进阶。</p><p>注：本文假设你具有关于 Linux 下文件系统的基本常识，例如知道如何创建 EXT4 系统，知道如何挂载文件系统。</p><h2 id=引子><a class=h-a href=#%e5%bc%95%e5%ad%90>引子</a></h2><p>假如你将块设备（比如 <code>/dev/sda2</code>）格式化为 BTRFS，你就得到了一个 BTRFS 文件系统，也同时得到了一个 BTRFS 卷。<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>
如常规的文件系统一样，之后运行 <code>mount /dev/sda2 /mnt</code> 就可以挂载这个 BTRFS 文件系统；不过从 BTRFS 的角度来看，被挂载的正是 BTRFS 卷。</p><p>下面我们通过具体的操作来介绍 BTRFS 文件系统。为了测试方便，我们不使用实际的块设备（例如 <code>/dev/sda2</code>），而是临时创建一个文件 <code>/tmp/vda</code> 来充当块设备，这样对系统就几乎没有影响了。</p><p>请打开一个 Linux 下的终端并进入 Bash 或 Zsh，并确保已安装 <code>btrfs-progs</code> （用于提供 <code>btrfs</code> 命令），下面我们一起实践操作。</p><h2 id=格式化与挂载><a class=h-a href=#%e6%a0%bc%e5%bc%8f%e5%8c%96%e4%b8%8e%e6%8c%82%e8%bd%bd>格式化与挂载</a></h2><p>先切换到 root 用户，方法自行决定，比如运行 <code>sudo su</code>。</p><p>然后，创建一个 256MB 的文件 <code>/tmp/vda</code> 作为测试用的块设备。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a></span><span class=cl>dd <span class=k>if</span><span class=o>=</span>/dev/zero <span class=nv>of</span><span class=o>=</span>/tmp/vda <span class=nv>bs</span><span class=o>=</span>1M <span class=nv>count</span><span class=o>=</span><span class=m>256</span>
</span></span></code></pre></div><p>注：这里还可以用 <code>losetup</code> 将 <code>/tmp/vda</code> 映射为块设备（例如 <code>/dev/loop0</code>），方便后续利用 <code>lsblk</code> 等工具（不过本文实际上没用到这些工具）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a></span><span class=cl>losetup -f /tmp/vda
</span></span><span class=line><span class=ln id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a></span><span class=cl>losetup -j /tmp/vda
</span></span></code></pre></div><p>将 <code>/tmp/vda</code> 格式化为 BTRFS，然后挂载：<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a></span><span class=cl>mkfs.btrfs /tmp/vda
</span></span><span class=line><span class=ln id=hl-2-2><a class=lnlinks href=#hl-2-2>2</a></span><span class=cl>mount -m /tmp/vda /tmp/mnt
</span></span></code></pre></div><p>BTRFS 卷的内部，有着它自己的目录结构，其中最顶级的就是 BTRFS 卷本身，在这个目录结构中的路径就是 <code>/</code>（不要与 Linux 系统本身<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>的 <code>/</code> 混淆）。</p><p>因此上面的挂载命令，实际上等价于<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a></span><span class=cl>mount -m /tmp/vda /tmp/mnt -o <span class=nv>subvol</span><span class=o>=</span>/
</span></span></code></pre></div><p>其中 <code>subvol</code><sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>的值 <code>/</code> ，就是 BTRFS 卷本身在<strong>它所含目录结构</strong>中的路径。</p><p>这样，在挂载之后，你就能在挂载点下看到卷所含的目录结构了（这是刚刚新建的卷，所以是空的）。</p><h2 id=子卷是目录><a class=h-a href=#%e5%ad%90%e5%8d%b7%e6%98%af%e7%9b%ae%e5%bd%95>子卷，是目录？</a></h2><p>与其他常规文件系统类似，你可以在这个目录里直接存放文件、文件夹等；但 BTRFS 的特性就在于，你可以选择创建一个子卷（subvolume），例如</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a></span><span class=cl><span class=c1># 创建 BTRFS 子卷 my-vol</span>
</span></span><span class=line><span class=ln id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a></span><span class=cl>btrfs subvolume create /tmp/mnt/my-vol
</span></span><span class=line><span class=ln id=hl-4-3><a class=lnlinks href=#hl-4-3>3</a></span><span class=cl><span class=c1># 创建 BTRFS 子卷 my-vol2</span>
</span></span><span class=line><span class=ln id=hl-4-4><a class=lnlinks href=#hl-4-4>4</a></span><span class=cl>btrfs subvolume create /tmp/mnt/my-vol/my-vol2
</span></span><span class=line><span class=ln id=hl-4-5><a class=lnlinks href=#hl-4-5>5</a></span><span class=cl><span class=c1># 创建普通目录 my-dir，再创建 BTRFS 子卷 my-vol3</span>
</span></span><span class=line><span class=ln id=hl-4-6><a class=lnlinks href=#hl-4-6>6</a></span><span class=cl>mkdir -p /tmp/mnt/my-dir
</span></span><span class=line><span class=ln id=hl-4-7><a class=lnlinks href=#hl-4-7>7</a></span><span class=cl>btrfs subvolume create /tmp/mnt/my-dir/my-vol3
</span></span></code></pre></div><p class=box-info>小技巧：<code>btrfs</code> 支持子命令缩写，即子命令在避免歧义的前提下可以缩短为前面的一部分。例如创建 <code>my-vol</code> 的命令可简写为 <code>btrfs su cr /tmp/mnt/my-vol</code>。</p><p>表面上，这个子卷 <code>my-vol</code> （以及 <code>my-vol2</code>、<code>my-vol3</code>）看起来与我们用 <code>mkdir</code> 创建的普通文件夹 <code>my-dir</code> 并没有什么本质区别（也正因此，有一种命名习惯是将子卷名称用 <code>@</code> 作为前缀以示区分）：</p><ul><li>可以用 <code>mv</code> 来移动它。</li><li>还可以用 <code>cp -r</code> 来复制它（但所得副本是普通目录而非子卷）。</li><li>甚至与 <code>stat /tmp/mnt/my-dir</code> 一样，<code>stat /tmp/mnt/my-vol</code> 也会告诉你它是一个目录（directory）。</li><li>想要删除它，也可以用 <code>rm -r</code>。<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup></li></ul><p>但对于 BTRFS 卷来说，这个子卷与其他文件夹有着本质区别。</p><h2 id=子卷能被列出><a class=h-a href=#%e5%ad%90%e5%8d%b7%e8%83%bd%e8%a2%ab%e5%88%97%e5%87%ba>子卷，能被列出</a></h2><p><code>btrfs</code> 可列出卷中的所有子卷（区别于普通目录）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a></span><span class=cl>btrfs subvolume list /tmp/mnt
</span></span></code></pre></div><p>输出结果如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a></span><span class=cl>ID 256 gen 7 top level 5 path my-vol
</span></span><span class=line><span class=ln id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a></span><span class=cl>ID 257 gen 7 top level 256 path my-vol/my-vol2
</span></span><span class=line><span class=ln id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a></span><span class=cl>ID 258 gen 7 top level 5 path my-dir/my-vol3
</span></span></code></pre></div><p>这里的 <code>gen 7</code> 指的是代序数为 7，因为不是很重要就略过了；<sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>
我们来看其它的部分：</p><p>对于子卷 <code>my-vol</code> ，</p><ul><li>ID 为 256，</li><li>上级子卷的 ID 为 5，<sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup></li><li>路径为 <code>/my-vol</code>。<sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup></li></ul><p>而子卷 <code>my-vol2</code> 位于 <code>my-vol</code> 下，</p><ul><li>ID 为 257，</li><li>上级子卷的 ID 为 256，<sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup></li><li>路径为 <code>/my-vol/my-vol2</code>。</li></ul><p>至于子卷 <code>my-vol3</code> 则位于普通目录 <code>my-dir</code> 下，</p><ul><li>ID 为 258，</li><li>上级子卷的 ID 为 5，</li><li>路径为 <code>/my-dir/my-vol3</code>。</li></ul><h2 id=子卷能指定参数挂载><a class=h-a href=#%e5%ad%90%e5%8d%b7%e8%83%bd%e6%8c%87%e5%ae%9a%e5%8f%82%e6%95%b0%e6%8c%82%e8%bd%bd>子卷，能指定参数挂载</a></h2><p>子卷的一个非常有用的特性是：你可以直接挂载它，而不需要先挂载它的上级（子）卷。</p><p>例如，先在 <code>my-vol2</code> 里建立一个空文件，再把顶级卷卸载：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a></span><span class=cl>touch /tmp/mnt/my-vol/my-vol2/testfile
</span></span><span class=line><span class=ln id=hl-7-2><a class=lnlinks href=#hl-7-2>2</a></span><span class=cl>umount /tmp/mnt
</span></span></code></pre></div><p>然后重新挂载，但这次用 <code>subvol</code> 来选择子卷 <code>my-vol2</code> ：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a></span><span class=cl>mount -m /tmp/vda /tmp/mnt -o <span class=nv>subvol</span><span class=o>=</span>/my-vol/my-vol2
</span></span></code></pre></div><p>再来看看挂载点 <code>/tmp/mnt</code> 下有什么：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a></span><span class=cl>ls /tmp/mnt
</span></span></code></pre></div><p>输出结果如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a></span><span class=cl>testfile
</span></span></code></pre></div><p>这就是我们刚才在子卷 <code>my-vol2</code> 里用 <code>touch</code> 创建的空文件。可见，我们成功地直接挂载了这个子卷（而没有挂载它的顶级卷）。</p><p>事实上，不仅挂载单个子卷时并不依赖其顶级卷，你还可以同时挂载 BTRFS 卷中的多个卷。例如，挂载我们刚才卸载的顶级卷 <code>/</code> 到 <code>/tmp/mnt0</code> ：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a></span><span class=cl>mount -m /tmp/vda /tmp/mnt0 -o <span class=nv>subvol</span><span class=o>=</span>/
</span></span></code></pre></div><p>再来看看挂载点 <code>/tmp/mnt0</code> 下有什么：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a></span><span class=cl>tree /tmp/mnt0
</span></span></code></pre></div><p>输出结果如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a></span><span class=cl>/tmp/mnt0
</span></span><span class=line><span class=ln id=hl-13-2><a class=lnlinks href=#hl-13-2>2</a></span><span class=cl>├── my-dir
</span></span><span class=line><span class=ln id=hl-13-3><a class=lnlinks href=#hl-13-3>3</a></span><span class=cl>│   └── my-vol3
</span></span><span class=line><span class=ln id=hl-13-4><a class=lnlinks href=#hl-13-4>4</a></span><span class=cl>└── my-vol
</span></span><span class=line><span class=ln id=hl-13-5><a class=lnlinks href=#hl-13-5>5</a></span><span class=cl>    └── my-vol2
</span></span><span class=line><span class=ln id=hl-13-6><a class=lnlinks href=#hl-13-6>6</a></span><span class=cl>        └── testfile
</span></span><span class=line><span class=ln id=hl-13-7><a class=lnlinks href=#hl-13-7>7</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-13-8><a class=lnlinks href=#hl-13-8>8</a></span><span class=cl>5 directories, 1 file
</span></span></code></pre></div><p>可见顶级卷也被成功挂载了，而已经被挂载的子卷 <code>my-vol2</code> 作为顶级卷下的子卷，也正常地出现了。</p><p>总之，同一个 BTRFS 卷中的各个子卷可以同时被分别挂载（即使它们之间有上下级关系），这有点类似于同一个磁盘上的各个分区；不同的是，对 BTRFS 子卷的调整非常方便快捷，且它们共享同一个分区的容量，因此你<strong>不</strong>需要像制作磁盘分区或 LVM 那样考虑容量的划分。<sup id=fnref:11><a href=#fn:11 class=footnote-ref role=doc-noteref>11</a></sup></p><p>注：你可以对不同子卷分别指定挂载选项，比如，我们可以重新挂载（remount） <code>my-vol2</code> 并开启 zstd 算法的透明压缩（<code>compress=zstd</code>）：<sup id=fnref:12><a href=#fn:12 class=footnote-ref role=doc-noteref>12</a></sup></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-14-1><a class=lnlinks href=#hl-14-1>1</a></span><span class=cl>mount /tmp/vda /tmp/mnt -o remount,subvol<span class=o>=</span>/my-vol/my-vol2,compress<span class=o>=</span>zstd
</span></span></code></pre></div><p>作为挂载选项，它只对这次挂载生效，若要长期使用透明压缩则应当把挂载选项配置到 <code>fstab</code> 中。</p><h2 id=子卷能被快照><a class=h-a href=#%e5%ad%90%e5%8d%b7%e8%83%bd%e8%a2%ab%e5%bf%ab%e7%85%a7>子卷，能被快照</a></h2><p>子卷还支持其他一些特性，其中最值得注意的特性之一就是快照（snapshot）。</p><p>当你为某个子卷创建快照时，你相当于复制了这个子卷；但得益于 BTRFS 的 COW（写时复制，Copy On Write），占用的容量并不会翻倍。</p><p class=box-info>与 <code>cp -r</code> 不同，用快照获得的副本是一个内容相同的<strong>子卷</strong>，而不是普通的目录；换句话说，快照也是子卷。</p><p class=box-warn>一个子卷的快照仅针对它本身；若子卷 <code>vol</code> 的下面还包含其他子卷如 <code>vol/vol1</code>、<code>vol/vol2</code> 等，或含有其他文件系统的挂载点，则在 <code>vol</code> 的快照中它们会变成普通的空目录。</p><p>例如，我们在 <code>my-vol</code> 中创建测试文件 <code>testA</code> 和 <code>testB</code> ，再来创建 <code>my-vol</code> 的快照：<sup id=fnref:13><a href=#fn:13 class=footnote-ref role=doc-noteref>13</a></sup></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a></span><span class=cl>touch /tmp/mnt0/my-vol/test<span class=o>{</span>A,B<span class=o>}</span>
</span></span><span class=line><span class=ln id=hl-15-2><a class=lnlinks href=#hl-15-2>2</a></span><span class=cl>btrfs subvolume snapshot /tmp/mnt0/my-vol /tmp/mnt0/my-vol-snapshot
</span></span></code></pre></div><p>再来看看挂载点 <code>/tmp/mnt0</code> 下有什么：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a></span><span class=cl>tree /tmp/mnt0
</span></span></code></pre></div><p>输出结果如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a></span><span class=cl>/tmp/mnt0
</span></span><span class=line><span class=ln id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a></span><span class=cl>├── my-dir
</span></span><span class=line><span class=ln id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a></span><span class=cl>│   └── my-vol3
</span></span><span class=line><span class=ln id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a></span><span class=cl>├── my-vol
</span></span><span class=line><span class=ln id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a></span><span class=cl>│   ├── my-vol2
</span></span><span class=line><span class=ln id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a></span><span class=cl>│   │   └── testfile
</span></span><span class=line><span class=ln id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a></span><span class=cl>│   ├── testA
</span></span><span class=line><span class=ln id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a></span><span class=cl>│   └── testB
</span></span><span class=line><span class=ln id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a></span><span class=cl>└── my-vol-snapshot
</span></span><span class=line><span class=ln id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a></span><span class=cl>    ├── my-vol2
</span></span><span class=line><span class=ln id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a></span><span class=cl>    ├── testA
</span></span><span class=line><span class=ln id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a></span><span class=cl>    └── testB
</span></span><span class=line><span class=ln id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a></span><span class=cl>7 directories, 5 files
</span></span></code></pre></div><p>可见 <code>my-vol</code> 被“复制”为 <code>my-vol-snapshot</code>。</p><p>它们具有相同的内容（注意快照中的 <code>my-vol2</code> 是一个普通的空目录），但不是同一个子卷：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-18-1><a class=lnlinks href=#hl-18-1>1</a></span><span class=cl>btrfs subvolume list /tmp/mnt0
</span></span></code></pre></div><p>输出结果如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln id=hl-19-1><a class=lnlinks href=#hl-19-1>1</a></span><span class=cl>ID 256 gen 12 top level 5 path my-vol
</span></span><span class=line><span class=ln id=hl-19-2><a class=lnlinks href=#hl-19-2>2</a></span><span class=cl>ID 257 gen 10 top level 256 path my-vol/my-vol2
</span></span><span class=line><span class=ln id=hl-19-3><a class=lnlinks href=#hl-19-3>3</a></span><span class=cl>ID 258 gen 11 top level 5 path my-dir/my-vol3
</span></span><span class=line><span class=ln id=hl-19-4><a class=lnlinks href=#hl-19-4>4</a></span><span class=cl>ID 259 gen 12 top level 5 path my-vol-snapshot
</span></span></code></pre></div><p>可以看到它们具有不同的子卷 ID。同时，对它们之一作修改，不会影响到另一个。</p><h2 id=子卷可以回滚到快照><a class=h-a href=#%e5%ad%90%e5%8d%b7%e5%8f%af%e4%bb%a5%e5%9b%9e%e6%bb%9a%e5%88%b0%e5%bf%ab%e7%85%a7>子卷，可以“回滚”到快照</a></h2><p>回滚（rollback）在一些版本管理系统中，指的是从当前版本回退到旧的版本。</p><p>由于我们可以把一个子卷的快照（在未经修改时）看作这个子卷的历史版本，BTRFS 事实上也是支持将子卷“回滚”到指定快照的。</p><p class=box-warn>BTRFS 文件系统自身并不提供直接的回滚命令。这是因为，快照本质上仍然是子卷，且与原本的子卷是相互独立的，BTRFS 文件系统本身并不会将它们标记为“具有快照关系”（虽然 COW 特性会使得它们具有的同一份文件不占用两份空间）。也就是说，虽然 BTRFS 支持回滚，但其具体实现是交由用户手动进行、或交给其他工具自动进行的。</p><p>那么，当你需要“回滚”子卷到某个快照时，应该怎么操作呢？很简单，就是“用快照子卷替代原本的子卷”。</p><p>当然，这需要你首先理解“原本的子卷是如何被<strong>指定</strong>的”这件事。</p><p>前面我们知道，在一个 BTRFS 卷下，每个子卷都有自己的 ID 与路径，用其中的任何一个都可以找到（指定）这个子卷。</p><p>例如，已知 <code>/my-vol</code> 的子卷 ID 为 256，可以用 <code>subvolid=256</code> 将它挂载到 <code>/tmp/mnt1</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-20-1><a class=lnlinks href=#hl-20-1>1</a></span><span class=cl>mount /tmp/vda /tmp/mnt1 -m -o <span class=nv>subvolid</span><span class=o>=</span><span class=m>256</span>
</span></span></code></pre></div><p>这与你指定 <code>subvol=/my-vol</code> 的效果是一致的。</p><p>而 <code>tree /tmp/mnt1</code> 的结果为</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln id=hl-21-1><a class=lnlinks href=#hl-21-1>1</a></span><span class=cl>/tmp/mnt1
</span></span><span class=line><span class=ln id=hl-21-2><a class=lnlinks href=#hl-21-2>2</a></span><span class=cl>├── my-vol2
</span></span><span class=line><span class=ln id=hl-21-3><a class=lnlinks href=#hl-21-3>3</a></span><span class=cl>│   └── testfile
</span></span><span class=line><span class=ln id=hl-21-4><a class=lnlinks href=#hl-21-4>4</a></span><span class=cl>├── testA
</span></span><span class=line><span class=ln id=hl-21-5><a class=lnlinks href=#hl-21-5>5</a></span><span class=cl>└── testB
</span></span><span class=line><span class=ln id=hl-21-6><a class=lnlinks href=#hl-21-6>6</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-21-7><a class=lnlinks href=#hl-21-7>7</a></span><span class=cl>2 directories, 3 files
</span></span></code></pre></div><p>现在，我们假装不小心删掉了 <code>testB</code> ：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-22-1><a class=lnlinks href=#hl-22-1>1</a></span><span class=cl>rm /tmp/mnt1/testB
</span></span></code></pre></div><p>这样， <code>tree /tmp/mnt1</code> 的结果变为</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln id=hl-23-1><a class=lnlinks href=#hl-23-1>1</a></span><span class=cl>/tmp/mnt1
</span></span><span class=line><span class=ln id=hl-23-2><a class=lnlinks href=#hl-23-2>2</a></span><span class=cl>├── my-vol2
</span></span><span class=line><span class=ln id=hl-23-3><a class=lnlinks href=#hl-23-3>3</a></span><span class=cl>│   └── testfile
</span></span><span class=line><span class=ln id=hl-23-4><a class=lnlinks href=#hl-23-4>4</a></span><span class=cl>└── testA
</span></span><span class=line><span class=ln id=hl-23-5><a class=lnlinks href=#hl-23-5>5</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-23-6><a class=lnlinks href=#hl-23-6>6</a></span><span class=cl>2 directories, 2 files
</span></span></code></pre></div><p>幸运的是，之前我们给 <code>my-vol</code> 做过快照！现在我们就来“回滚”到它，最简单的方法就是改变 <code>subvolid</code> 为快照的 ID 即 259，这样重新挂载到 <code>/tmp/mnt1</code> ：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-24-1><a class=lnlinks href=#hl-24-1>1</a></span><span class=cl>umount /tmp/mnt1
</span></span><span class=line><span class=ln id=hl-24-2><a class=lnlinks href=#hl-24-2>2</a></span><span class=cl>mount /tmp/vda /tmp/mnt1 -o <span class=nv>subvolid</span><span class=o>=</span><span class=m>259</span>
</span></span></code></pre></div><p>这样“回滚”之后， <code>tree /tmp/mnt1</code> 的结果变为</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln id=hl-25-1><a class=lnlinks href=#hl-25-1>1</a></span><span class=cl>/tmp/mnt1
</span></span><span class=line><span class=ln id=hl-25-2><a class=lnlinks href=#hl-25-2>2</a></span><span class=cl>├── my-vol2
</span></span><span class=line><span class=ln id=hl-25-3><a class=lnlinks href=#hl-25-3>3</a></span><span class=cl>├── testA
</span></span><span class=line><span class=ln id=hl-25-4><a class=lnlinks href=#hl-25-4>4</a></span><span class=cl>└── testB
</span></span><span class=line><span class=ln id=hl-25-5><a class=lnlinks href=#hl-25-5>5</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-25-6><a class=lnlinks href=#hl-25-6>6</a></span><span class=cl>2 directories, 2 files
</span></span></code></pre></div><p>很简单，对吧？</p><p>同理，我们也可以改变 <code>subvol</code> 来指定快照子卷：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-26-1><a class=lnlinks href=#hl-26-1>1</a></span><span class=cl>umount /tmp/mnt1
</span></span><span class=line><span class=ln id=hl-26-2><a class=lnlinks href=#hl-26-2>2</a></span><span class=cl>mount /tmp/vda /tmp/mnt1 -o <span class=nv>subvol</span><span class=o>=</span>/my-vol-snapshot
</span></span></code></pre></div><p>其效果是一致的。</p><p>而除了更改挂载参数，我们还可以改变子卷本身的路径。<sup id=fnref:14><a href=#fn:14 class=footnote-ref role=doc-noteref>14</a></sup></p><p>首先将子卷 <code>my-vol2</code> 从 <code>my-vol</code> 中移动到快照 <code>my-vol-snapshot</code> 中<sup id=fnref:15><a href=#fn:15 class=footnote-ref role=doc-noteref>15</a></sup></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-27-1><a class=lnlinks href=#hl-27-1>1</a></span><span class=cl>mv /tmp/mnt0/<span class=o>{</span>my-vol/,<span class=o>}</span>my-vol2
</span></span><span class=line><span class=ln id=hl-27-2><a class=lnlinks href=#hl-27-2>2</a></span><span class=cl>mv /tmp/mnt0/<span class=o>{</span>my-vol2,my-vol-snapshot/<span class=o>}</span>
</span></span></code></pre></div><p>然后，我们将原本的子卷 <code>/my-vol</code> 移动到另一个位置，再把快照子卷移到它原本的位置来完成对它的代替：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-28-1><a class=lnlinks href=#hl-28-1>1</a></span><span class=cl>mv /tmp/mnt0/my-vol<span class=o>{</span>,-bad<span class=o>}</span>
</span></span><span class=line><span class=ln id=hl-28-2><a class=lnlinks href=#hl-28-2>2</a></span><span class=cl>mv /tmp/mnt0/my-vol<span class=o>{</span>-snapshot,<span class=o>}</span>
</span></span></code></pre></div><p>这样，在“子卷的指定方法是指定其路径为 <code>/my-vol</code>”的前提条件下，我们就已经回滚成功了，以下进行验证（即指定子卷路径 <code>/my-vol</code> 来进行挂载）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-29-1><a class=lnlinks href=#hl-29-1>1</a></span><span class=cl>umount /tmp/mnt1
</span></span><span class=line><span class=ln id=hl-29-2><a class=lnlinks href=#hl-29-2>2</a></span><span class=cl>mount /tmp/vda /tmp/mnt1 -o <span class=nv>subvol</span><span class=o>=</span>/my-vol
</span></span></code></pre></div><p><code>tree /tmp/mnt1</code> 的结果为</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln id=hl-30-1><a class=lnlinks href=#hl-30-1>1</a></span><span class=cl>/tmp/mnt1
</span></span><span class=line><span class=ln id=hl-30-2><a class=lnlinks href=#hl-30-2>2</a></span><span class=cl>├── my-vol2
</span></span><span class=line><span class=ln id=hl-30-3><a class=lnlinks href=#hl-30-3>3</a></span><span class=cl>│   └── testfile
</span></span><span class=line><span class=ln id=hl-30-4><a class=lnlinks href=#hl-30-4>4</a></span><span class=cl>├── testA
</span></span><span class=line><span class=ln id=hl-30-5><a class=lnlinks href=#hl-30-5>5</a></span><span class=cl>└── testB
</span></span><span class=line><span class=ln id=hl-30-6><a class=lnlinks href=#hl-30-6>6</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-30-7><a class=lnlinks href=#hl-30-7>7</a></span><span class=cl>2 directories, 3 files
</span></span></code></pre></div><p>可见回滚操作确实成功了；你还可以用 <code>rm -rf /tmp/mnt1/my-vol-bad</code> 来删掉被我们抛弃的那个子卷，这不会影响你回滚的结果。</p><p>总结一下，一般地，我们有三种回滚快照的方法（任选其一）：</p><ul><li>改变挂载参数中 <code>subvol</code> 的值为快照子卷的路径。</li><li>改变挂载参数中 <code>subvolid</code> 的值为快照子卷的 ID。</li><li>（在挂载参数采用 <code>subvol</code> 且固定不变的前提下）用 <code>mv</code> 移动快照子卷来替换原本的子卷。</li></ul><p>扩展：</p><ul><li>如果你的快照子卷是只读的，你需要对这个快照子卷本身再次进行快照（当然，这次不可以指定只读属性了），从而得到一个可读写的快照，用它来替代原本的子卷即可。</li><li>直接从子卷用 <code>rsync</code> 或 <code>cp</code> 复制文件来覆盖当前子卷，也不失为一种方法，但这并不总是可靠的。</li></ul><h2 id=子卷可以跨设备传输><a class=h-a href=#%e5%ad%90%e5%8d%b7%e5%8f%af%e4%bb%a5%e8%b7%a8%e8%ae%be%e5%a4%87%e4%bc%a0%e8%be%93>子卷，可以跨设备传输</a></h2><p>只读（read only）子卷可以被跨设备传输；对于可读写的子卷，可手动对它进行只读快照，再传输这个快照子卷。</p><ul><li>使用 <code>btrfs send &lt;只读子卷></code> 可以将子卷输出到 stdout，</li><li>使用 <code>btrfs receive &lt;目录></code> 则从 stdin 接受数据，在新设备的目录下生成同名子卷。</li></ul><p>通过管道就能将两者配合起来，甚至可以实现远程传输。</p><p>现在，我们为 <code>my-vol</code> 创建一个只读快照子卷：<sup id=fnref:16><a href=#fn:16 class=footnote-ref role=doc-noteref>16</a></sup></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-31-1><a class=lnlinks href=#hl-31-1>1</a></span><span class=cl>btrfs subvolume snapshot -r /tmp/mnt0/my-vol /tmp/mnt0/my-vol-ro
</span></span></code></pre></div><p>创建另一个虚拟块设备 <code>vdb</code> 并格式化为 BTRFS：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-32-1><a class=lnlinks href=#hl-32-1>1</a></span><span class=cl>dd <span class=k>if</span><span class=o>=</span>/dev/zero <span class=nv>of</span><span class=o>=</span>/tmp/vdb <span class=nv>bs</span><span class=o>=</span>1M <span class=nv>count</span><span class=o>=</span><span class=m>256</span>
</span></span><span class=line><span class=ln id=hl-32-2><a class=lnlinks href=#hl-32-2>2</a></span><span class=cl>mkfs.btrfs /tmp/vdb
</span></span><span class=line><span class=ln id=hl-32-3><a class=lnlinks href=#hl-32-3>3</a></span><span class=cl>mount -m /tmp/vdb /tmp/mntB
</span></span><span class=line><span class=ln id=hl-32-4><a class=lnlinks href=#hl-32-4>4</a></span><span class=cl>mkdir -p /tmp/mntB/my-recv
</span></span></code></pre></div><p>接下来，将只读子卷存放到 <code>vdb</code> 的 BTRFS 卷里：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-33-1><a class=lnlinks href=#hl-33-1>1</a></span><span class=cl>btrfs send /tmp/mnt0/my-vol-ro <span class=p>|</span> btrfs receive /tmp/mntB/my-recv
</span></span></code></pre></div><p class=box-info>若目标设备在另一台计算机上，可用 <code>btrfs send &lt;只读子卷> | zstd | ssh root@&lt;远程计算机地址> 'zstd -d | btrfs receive &lt;接收目录>'</code> 这种命令，利用 SSH 远程传输。</p><p>此时 <code>tree /tmp/mntB</code> 的结果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln id=hl-34-1><a class=lnlinks href=#hl-34-1>1</a></span><span class=cl>/tmp/mntB
</span></span><span class=line><span class=ln id=hl-34-2><a class=lnlinks href=#hl-34-2>2</a></span><span class=cl>└── my-recv
</span></span><span class=line><span class=ln id=hl-34-3><a class=lnlinks href=#hl-34-3>3</a></span><span class=cl>    └── my-vol-ro
</span></span><span class=line><span class=ln id=hl-34-4><a class=lnlinks href=#hl-34-4>4</a></span><span class=cl>        ├── testA
</span></span><span class=line><span class=ln id=hl-34-5><a class=lnlinks href=#hl-34-5>5</a></span><span class=cl>        └── testB
</span></span><span class=line><span class=ln id=hl-34-6><a class=lnlinks href=#hl-34-6>6</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-34-7><a class=lnlinks href=#hl-34-7>7</a></span><span class=cl>3 directories, 2 files
</span></span></code></pre></div><p>上面我们传输了一个完整的只读子卷；之后如果原本的子卷有变动，也可以用 <code>-p &lt;parent></code> 执行增量传输。</p><p>例如在原本的子卷 <code>my-vol</code> 中添加文件 <code>testC</code> 然后创建只读快照 <code>my-vol-ro2</code> ：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-35-1><a class=lnlinks href=#hl-35-1>1</a></span><span class=cl>touch /tmp/mnt0/my-vol/testC
</span></span><span class=line><span class=ln id=hl-35-2><a class=lnlinks href=#hl-35-2>2</a></span><span class=cl>btrfs subvolume snapshot -r /tmp/mnt0/my-vol /tmp/mnt0/my-vol-ro2
</span></span></code></pre></div><p>利用 <code>-p</code> 指定以 <code>my-vol-ro</code> 为基准，到 <code>my-vol-ro2</code> 的增量传输：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln id=hl-36-1><a class=lnlinks href=#hl-36-1>1</a></span><span class=cl>btrfs send -p /tmp/mnt0/my-vol-ro /tmp/mnt0/my-vol-ro2 <span class=p>|</span> btrfs receive /tmp/mntB/my-recv
</span></span></code></pre></div><p>此时 <code>tree /tmp/mntB</code> 的结果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln id=hl-37-1><a class=lnlinks href=#hl-37-1> 1</a></span><span class=cl>/tmp/mntB
</span></span><span class=line><span class=ln id=hl-37-2><a class=lnlinks href=#hl-37-2> 2</a></span><span class=cl>└── my-recv
</span></span><span class=line><span class=ln id=hl-37-3><a class=lnlinks href=#hl-37-3> 3</a></span><span class=cl>    ├── my-vol-ro
</span></span><span class=line><span class=ln id=hl-37-4><a class=lnlinks href=#hl-37-4> 4</a></span><span class=cl>    │   ├── testA
</span></span><span class=line><span class=ln id=hl-37-5><a class=lnlinks href=#hl-37-5> 5</a></span><span class=cl>    │   └── testB
</span></span><span class=line><span class=ln id=hl-37-6><a class=lnlinks href=#hl-37-6> 6</a></span><span class=cl>    └── my-vol-ro2
</span></span><span class=line><span class=ln id=hl-37-7><a class=lnlinks href=#hl-37-7> 7</a></span><span class=cl>        ├── testA
</span></span><span class=line><span class=ln id=hl-37-8><a class=lnlinks href=#hl-37-8> 8</a></span><span class=cl>        ├── testB
</span></span><span class=line><span class=ln id=hl-37-9><a class=lnlinks href=#hl-37-9> 9</a></span><span class=cl>        └── testC
</span></span><span class=line><span class=ln id=hl-37-10><a class=lnlinks href=#hl-37-10>10</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-37-11><a class=lnlinks href=#hl-37-11>11</a></span><span class=cl>4 directories, 5 files
</span></span></code></pre></div><p>当然，即使刚才没有指定 <code>-p /tmp/mnt0/my-vol-ro</code> ，<code>tree /tmp/mntB</code> 的结果也是一样的。这个参数的作用，主要是节省传输所消耗的流量与空间占用。</p><h2 id=btrfs-资料指路><a class=h-a href=#btrfs-%e8%b5%84%e6%96%99%e6%8c%87%e8%b7%af>BTRFS 资料指路</a></h2><p>恭喜你完成了本指南！</p><p>本文的主要内容到这里也就结束了；<sup id=fnref:17><a href=#fn:17 class=footnote-ref role=doc-noteref>17</a></sup>
想了解关于 BTRFS 的更多知识，这里推荐一些资料供参考。</p><p>最权威的资料：</p><ul><li><a class="link link--text" href=https://btrfs.wiki.kernel.org rel=external>BTRFS | wiki.kernel.org</a>，原本的 BTRFS 官方文档，目前已被归档。</li><li><a class="link link--text" href=https://btrfs.readthedocs.io rel=external>BTRFS Documentation</a>，最新的 BTRFS 官方文档，但旧文档的内容没有完全迁移过来。</li></ul><p>一些发行版的 Wiki：</p><ul><li><a class="link link--text" href=https://wiki.archlinux.org/title/Btrfs rel=external>BTRFS | Arch Wiki</a></li><li><a class="link link--text" href=https://wiki.gentoo.org/wiki/Btrfs rel=external>BTRFS | Gentoo Wiki</a></li><li><a class="link link--text" href=https://nixos.wiki/wiki/Btrfs rel=external>BTRFS | NixOS Wiki</a></li><li><a class="link link--text" href=https://wiki.debian.org/Btrfs rel=external>BTRFS | Debian Wiki</a></li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>所谓的“卷”并不是 BTRFS 的独创，例如在 LVM 中也有卷的概念。这里的“卷”类似于“具有文件系统的磁盘分区”，是可以被挂载的对象。&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>其中 <code>-m</code> 即 <code>--mkdir</code> 表示在需要时自动创建挂载点目录；部分发行版的 mount 可能不支持这个参数，此时去掉这个参数并手动创建挂载点目录即可。&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>严谨地说，是 <a class="link link--text" href=https://docs.kernel.org/filesystems/vfs.html rel=external>VFS</a>。&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>如果你修改了此 BTRFS 卷的默认子卷，则等价关系可能不再成立。至于什么是子卷，后面将进一步介绍。&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>subvol 即 subvolume 的简称。&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p>要删除只读子卷，需要使用 <code>btrfs subvolume delete</code>。&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p>子卷的“代序数”（generation number）是指一个整数，用以标识每个子卷的创建顺序。这里没有译为“代数”是因为数学上已经有“代数”（algebra）；另外这个译法也未必合适，因为 generation 亦有“生成”之意，后续可能会调整。&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p>这个上级子卷没有出现在列表中，因为它就是 BTRFS 卷本身，ID 固定为 5。&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9><p>前面的输出结果中省略了前置的 <code>/</code>。&#160;<a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10><p>ID 为 256 的子卷就是 <code>my-vol</code>。&#160;<a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:11><p>虽然你很可能用不到，BTRFS 也支持强制为子卷指定容量上限，这个功能叫做“配额”（quota），但目前不太稳定，不建议新手使用。&#160;<a href=#fnref:11 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:12><p>透明压缩是 BTRFS 的特色功能之一，它会以一定的 CPU 占用为代价，节省一定空间（具体的压缩率与文件内容有关），并可一定程度上提高读写性能。&#160;<a href=#fnref:12 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:13><p>要创建只读快照，需要带 <code>-r</code> 参数。&#160;<a href=#fnref:13 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:14><p>但你无法更改子卷的 ID，它是永久的，见 <a class="link link--text" href=https://btrfs.readthedocs.io/en/latest/btrfs-subvolume.html rel=external>BTRFS 文档</a>。&#160;<a href=#fnref:14 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:15><p>你可能注意到，这里嵌套（nesting）的子卷 <code>my-vol2</code> 给快照相关的一些操作带来了麻烦。因此，实践中笔者并不推荐在想要快照的子卷中嵌套子卷，而应改用“在挂载点下的子目录挂载其他子卷”的方案，这个方案同样可以起到避免某些目录被一同纳入快照的效果。&#160;<a href=#fnref:15 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:16><p>ro 是 read only 的缩写。&#160;<a href=#fnref:16 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:17><p>测试时生成的文件在 <code>/tmp</code> 下，会被自动清除；如果你想立即清除它们，可运行： <code>losetup -D /tmp/vda; umount /tmp/mnt{,0,1,B}; rm /tmp/vd{a,b}</code> 。&#160;<a href=#fnref:17 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=margin-full><section class=section><h2>相关阅读</h2><nav class="card-nav card-nav--2"><ul class=card-nav__list><li class="card card--1 card--1--row"><a href=/p/73c96d8f7/understand-backquote/ class=card__hover><div class="card__flex card__flex--half"><figure class="fig fig--w-tiny card__fig card__fig--half"><span class="img__frame img__frame--box-shadow img__frame--pad-none" style="display:flex;justify-content:center;align-items:center;background-image:linear-gradient(to right,#d7d2cd,#afc664)"><span class=img__c style=position:relative;width:100%;height:0;padding-bottom:86.2069%><img alt=featured class="img--ls img--ph lazyload" data-optimumx=auto data-sizes=auto data-srcset="/p/73c96d8f7/understand-backquote/pic.external/include-yy/article-1800x1552--128x.webp 128w, /p/73c96d8f7/understand-backquote/pic.external/include-yy/article-1800x1552--143x.webp 143w, /p/73c96d8f7/understand-backquote/pic.external/include-yy/article-1800x1552--159x.webp 159w, /p/73c96d8f7/understand-backquote/pic.external/include-yy/article-1800x1552--165x.webp 165w, /p/73c96d8f7/understand-backquote/pic.external/include-yy/article-1800x1552--178x.webp 178w, /p/73c96d8f7/understand-backquote/pic.external/include-yy/article-1800x1552--199x.webp 199w, /p/73c96d8f7/understand-backquote/pic.external/include-yy/article-1800x1552--222x.webp 222w, /p/73c96d8f7/understand-backquote/pic.external/include-yy/article-1800x1552--248x.webp 248w, /p/73c96d8f7/understand-backquote/pic.external/include-yy/article-1800x1552--276x.webp 276w, /p/73c96d8f7/understand-backquote/pic.external/include-yy/article-1800x1552--308x.webp 308w, /p/73c96d8f7/understand-backquote/pic.external/include-yy/article-1800x1552--344x.webp 344w, /p/73c96d8f7/understand-backquote/pic.external/include-yy/article-1800x1552--384x.webp 384w, /p/73c96d8f7/understand-backquote/pic.external/include-yy/article-1800x1552--429x.webp 429w" height=142 src=/p/73c96d8f7/understand-backquote/pic.external/include-yy/article-1800x1552--165x.webp srcset=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 width=165></span></span></figure><div class=card__content><div><div class=card__header><div class="meta meta--card meta--card--half"><ul class="ul--row meta__list"><li class="meta__item meta__list"><span class=meta__text>散文屋</span></li></ul></div><h3 class="card__title card__title--half">关于 backquote 理解的一个汇总与总结</h3></div></div></div></div></a></li></ul></nav></section></div></article><footer class="page-footer margin-full"><div class="meta meta--foot"><nav><ul class=meta__list><li class="taxo-shape taxo-shape--category"><ul class=ul--row><li class=meta__hanging><a class="link link--nav" href=/categories/ title="All Categories"><span class='icon icon--material icon--tiny'><svg viewBox="0 0 20 20"><path d="m5.042 9.479 4.979-8.146L15 9.479zm9.666 9.167q-1.646.0-2.791-1.156-1.146-1.157-1.146-2.782.0-1.646 1.146-2.791 1.145-1.146 2.791-1.146 1.625.0 2.782 1.146 1.156 1.145 1.156 2.791.0 1.625-1.156 2.782-1.157 1.156-2.782 1.156zm-12.583-.417v-7.062h7.063v7.062z"/></svg></span></a></li><li class="meta__item meta__item--taxo"><a class="meta__text link link--nav" href=/categories/knowledge/>知识向</a></li></ul></li><li class="taxo-shape taxo-shape--tag"><ul class=ul--row><li class=meta__hanging><a class="link link--nav" href=/tags/ title="All Tags"><span class='icon icon--material icon--tiny'><svg viewBox="0 0 20 20"><path d="M3.188 10.542v5.875L.917 15.5zm4.062 7.75h-2.5V11.5zm1.958.75L4.146 5.333 14 1.75l5.042 13.729zm.021-10.5q.396.0.677-.282.282-.281.282-.677.0-.375-.282-.656-.281-.281-.677-.281-.375.0-.656.281t-.281.656q0 .396.281.677.281.282.656.282z"/></svg></span></a></li><li class="meta__item meta__item--taxo"><a class="meta__text link link--nav" href=/tags/linux/>Linux
</a>&zwj;<span class=meta__separator>•</span></li><li class="meta__item meta__item--taxo"><a class="meta__text link link--nav" href=/tags/btrfs/>Btrfs</a></li></ul></li></ul><ul class="ul--row meta__list"><li class=meta__item><a class="meta__icon link link--nav" href=/ title=Home rel=nofollow><span class='icon icon--material icon--tiny'><svg viewBox="0 0 20 20"><path d="M3.167 17.667V7.438L10 2.292l6.833 5.146v10.229h-5.75v-5.646H8.896v5.646z"/></svg></span></a></li><li class=meta__item><span class=meta__separator>›</span></li><li class=meta__item><a class="meta__text link link--nav" href=/blog/ rel=nofollow>散文屋
</a><span class=meta__separator>›</span></li><li class=meta__item><a class="meta__text link link--nav" href=/p/25dbc0cc9/btrfs-simple-intro/ aria-current=page rel=nofollow>BTRFS 实践式快速入门</a></li></ul></nav><ul class="meta__list meta__list--date"><li class=meta__item><span class=meta__icon><span class='icon icon--material icon--tiny'><svg viewBox="0 0 20 20"><path d="m16.208 7.604-3.75-3.771 2.271-2.291 3.792 3.75zm-13.75 9.979v-3.75l8.771-8.771 3.75 3.75-8.75 8.771z"/></svg></span>
</span><time class=meta__text datetime=2024-06-07T23:08:00+08:00>Jun 7, 2024</time></li><li class=meta__item><span class=meta__icon><span class='icon icon--material icon--tiny'><svg viewBox="0 0 20 20"><path d="M10 18.5q-1.771.0-3.323-.667-1.552-.666-2.698-1.812t-1.812-2.698Q1.5 11.771 1.5 10t.667-3.323q.666-1.552 1.812-2.698t2.698-1.812Q8.229 1.5 10 1.5t3.323.667q1.552.666 2.698 1.812t1.812 2.698Q18.5 8.229 18.5 10t-.667 3.323q-.666 1.552-1.812 2.698t-2.698 1.812Q11.771 18.5 10 18.5zm2.583-4.562 1.375-1.355-3-2.979V5.896H9.042v4.458z"/></svg></span>
</span><span class=meta__text>11:08 pm</span></li><li class=meta__item><span class=meta__icon><a class="link link--nav" href=/authors/ title="All authors" rel=nofollow><span class='icon icon--material icon--tiny'><svg viewBox="0 0 20 20"><path d="M15.042 11.458V9.042h-2.417V7.208h2.417V4.792h1.833v2.416h2.417v1.834h-2.417v2.416zm-7.48-1.562q-1.479.0-2.489-1.011-1.011-1.01-1.011-2.489.0-1.5 1.011-2.5 1.01-1 2.489-1 1.5.0 2.511 1 1.01 1 1.01 2.5.0 1.479-1.01 2.489-1.011 1.011-2.511 1.011zM.688 16.917v-2.563q0-.792.406-1.406.406-.615 1.052-.948 1.312-.625 2.677-.938 1.365-.312 2.76-.312 1.417.0 2.792.323t2.667.927q.646.312 1.041.938.396.624.396 1.416v2.563z"/></svg></span>
</a></span><a class="meta__text link link--nav" href=/authors/clsty/ rel=nofollow>Clsty</a></li></ul></div><hr><nav class=page-nav><ul class=page-nav__list><li class=page-nav__li><a href=/blog/ class="page-nav__link page-nav__link--prev link link--nav"><span class=page-nav__icon></span><div class=page-nav__title><span class=text>散文屋</span></div><span class="page-nav__icon page-nav__icon--arrow"><span class='icon icon--material icon--normal'><svg viewBox="0 0 24 24"><path d="M9.075 18.675 2.4 12l6.675-6.675 1.075 1.05-4.875 4.875h16.15v1.5H5.275l4.85 4.875z"/></svg></span></span></a></li><li class=page-nav__li><a href=/p/feda224a0/website-link-management-prevent-404/ class="page-nav__link page-nav__link--next link link--nav"><span class=page-nav__icon></span><div class=page-nav__title><span class=text>浅谈网站 URL 管理与预防 404</span></div><span class="page-nav__icon page-nav__icon--arrow"><span class='icon icon--material icon--normal'><svg viewBox="0 0 24 24"><path d="m14.725 18.675-1.05-1.05 4.875-4.875H2.4v-1.5h16.15l-4.875-4.875 1.05-1.05 6.7 6.675z"/></svg></span></span></a></li></ul></nav><div class="meta meta--foot"><link href=https://art.celestialy.top/dist/Artalk.css rel=stylesheet><script src=https://art.celestialy.top/dist/Artalk.js></script><div id=Comments></div><script>Artalk.init({el:"#Comments",pageKey:"25dbc0cc9",pageTitle:"BTRFS 实践式快速入门",server:"https://art.celestialy.top",site:"clsty-css",darkMode:"auto",gravatar:{mirror:"https://cravatar.cn/avatar/",default:"mp"}})</script></div></footer></div><footer id=l-footer class="l-box margin-full-half"><div class=l-footer__columns><div class="md md--footer md--frame footer__col"><h2>clsty 的网络空间站</h2><figure class="fig fig--w-tiny" id=fig-1><a class="img__frame img__frame--box-shadow" href=/about style="display:flex;justify-content:center;align-items:center;background-image:linear-gradient(to right,#333740,#6690dc)"><span class=img__c style=position:relative;width:100%;height:0;padding-bottom:35.7143%><img class="img--ls img--lqip lazyload" data-optimumx=auto data-sizes=auto data-srcset="/site/footer/about._production/avatar-460x164--Center-128x.webp 128w, /site/footer/about._production/avatar-460x164--Center-143x.webp 143w, /site/footer/about._production/avatar-460x164--Center-159x.webp 159w, /site/footer/about._production/avatar-460x164--Center-165x.webp 165w, /site/footer/about._production/avatar-460x164--Center-178x.webp 178w, /site/footer/about._production/avatar-460x164--Center-199x.webp 199w, /site/footer/about._production/avatar-460x164--Center-222x.webp 222w, /site/footer/about._production/avatar-460x164--Center-248x.webp 248w, /site/footer/about._production/avatar-460x164--Center-276x.webp 276w, /site/footer/about._production/avatar-460x164--Center-308x.webp 308w, /site/footer/about._production/avatar-460x164--Center-344x.webp 344w, /site/footer/about._production/avatar-460x164--Center-384x.webp 384w, /site/footer/about._production/avatar-460x164--Center-429x.webp 429w" height=59 src=data:image/webp;base64,UklGRqAAAABXRUJQVlA4IJQAAAAwBgCdASo3ABQAPyV0qEmnI6Ib/VQAcxJE84BgyA3Sir6Y46YmWooQvniL984np5EkEN8Y8dyI/3WAAP654Yuz59xy24p5KprpRxxhEQmsqQZJ0GjaGejMrtSxYmf/vYJBiSU5YrHPhSLv5Oh4zXstEm9DV97WCpt9tTkSKW8AJIdiluzjfGROvoNMeVegTsDuIwAA width=165></span></a></figure><p>2023-2024 © <a class="link link--text" href=/about>clsty</a> 版权所有</p></div><div class="md md--footer md--frame footer__col"><h2>全站内容共享协议</h2><figure class="fig fig--w-tiny" id=cc><a aria-label="Creative Commons 4.0 logo" class="img__frame img__frame--bg-none img__frame--box-shadow" href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans><span class="img__c img__c--t-symbol"><img alt="Creative Commons 4.0 logo" class=img--svg loading=lazy src=/site/footer/cc/by-nc-sa.svg></span></a></figure><p><a class="link link--text" href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans rel=external>CC BY-NC-SA 4.0</a>，除非另作说明</p></div><div class="md md--footer md--frame footer__col"><h2>相关链接</h2><ul><li><a class="link link--text" href=https://css.celestialy.top rel=external>本站（部署于 Cloudflare）</a></li><li><a class="link link--text" href=https://blog.celestialy.top rel=external>本站（部署于 GitHub）</a></li><li><a class="link link--text" href=https://arcn.celestialy.top/ rel=external>arCNiso 文档</a></li><li><a class="link link--text" href=https://alist.celestialy.top rel=external>存储分享（密码 clsty）</a></li></ul></div><div class="md md--footer md--frame footer__col"><h2>站点框架</h2><figure class="fig fig--w-tiny" id=hugo><a aria-label=Hugo class="img__frame img__frame--bg-none img__frame--box-shadow img__frame--pad-half" href=https://gohugo.io><span class="img__c img__c--t-symbol"><img alt=Hugo class=img--svg loading=lazy src=/site/footer/framework/Hugo.2.svg></span></a></figure><figure class="fig fig--w-text" id=perplex><a aria-label=Perplex class="img__frame img__frame--bg-none img__frame--box-shadow img__frame--pad-half" href=https://github.com/bowman2001/perplex><span class="img__c img__c--t-symbol"><svg viewBox="0 0 717 131"><g transform="translate(-13.3,-77.7)" aria-label="PERPLEX"><path d="m13.3 208V78h53.9q17.2.0 25.9 10.6 8.96 10.6 8.96 29.3t-8.96 29.3q-8.77 10.6-25.9 10.6H36.6v50.4zm23.3-70.7h28.2q5.97.0 9.33-3.17 3.55-3.36 3.55-10.6v-11.6q0-7.28-3.55-10.5-3.36-3.36-9.33-3.36H36.6z" fill="#c9177e"/><path d="m123 208V78h78.2v20.3h-54.9v34h48v19.8h-48v35.8h54.9v20.3z" fill="#8b8b8b"/><path d="m247 208h-23.3V78h53.9q17.2.0 25.9 10.5 8.96 10.5 8.96 29.1.0 14.7-5.6 24.5-5.6 9.52-16.4 13.1l23.7 53.2h-25.2l-21.5-51.3h-20.5zm28.2-70.7q5.97.0 9.33-3.17 3.55-3.17 3.55-10.6v-11.6q0-7.47-3.55-10.6-3.36-3.17-9.33-3.17H247v39.2z" fill="#0083c0"/><path d="m333 208V78h53.9q17.2.0 25.9 10.6 8.96 10.6 8.96 29.3t-8.96 29.3q-8.77 10.6-25.9 10.6h-30.6v50.4zm23.3-70.7h28.2q5.97.0 9.33-3.17 3.55-3.36 3.55-10.6v-11.6q0-7.28-3.55-10.5-3.36-3.36-9.33-3.36h-28.2z" fill="#8d8d8d"/><path d="m443 208V78h23.3v110H512v20.3z" fill="#00a88a"/><path d="m533 208V78h78.2v20.3h-54.9v34h48v19.8h-48v35.8h54.9v20.3z" fill="#8b8b8b"/><path d="m730 208h-26.9l-25.4-48.7h-2.43l-25 48.7h-25l37.1-66.6-35.3-63.7h26.7l23.1 45.2h2.61l23.5-45.2h25l-35.8 63.5z" fill="#ebb923"/></g></svg></span></a></figure><p><a class="link link--text" href=https://gohugo.io rel=external>Hugo</a> × <a class="link link--text" href=https://github.com/bowman2001/perplex rel=external>Perplex</a> [Apache 2.0]</p></div></div></footer></main><div id=l-overlay></div></div><script defer src=/js/foot.min.e64a7ab658572cb6d73b058cfbcca1e125e8928a3b71c7b63b88a377133bddbd.js integrity="sha256-5kp6tlhXLLbXOwWM+8yh4SXokoo7cce2O4ijdxM73b0="></script></body></html>